<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modern Poker</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
            min-height: 100vh;
        }
        #pokerSvg {
            width: 800px;
            height: 600px;
        }
        #controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: #1a73e8;
            color: white;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
        }
        button:hover {
            background: #1557b0;
        }
        button:active {
            transform: scale(0.98);
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        #betOptions {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        #betOptions button {
            padding: 8px 15px;
            font-size: 14px;
        }
        #customBet {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 80px;
        }
        .chip-box {
            padding: 5px 10px;
            background: #fff;
            border: 1px solid #333;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }
        #pastHandsBtn {
            position: absolute;
            bottom: -60px;
            left: 0;
        }
        #pastHandsMenu {
            display: none;
            position: absolute;
            bottom: -50px;
            left: 120px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 10;
        }
        .hand-entry {
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <svg id="pokerSvg" viewBox="0 0 800 600"></svg>
    <div id="controls">
        <button id="sitDownBtn" onclick="sitDown()">Sit Down</button>
        <button id="betBtn" onclick="toggleBetOptions()" disabled>Bet</button>
        <button onclick="fold()">Fold</button>
        <button onclick="advanceGame()">Next</button>
        <div id="betOptions" style="display: none;">
            <button onclick="bet(10)">10</button>
            <button onclick="bet(Math.floor(pot / 4))">1/4 Pot</button>
            <button onclick="bet(Math.floor(pot / 2))">1/2 Pot</button>
            <button onclick="bet(pot)">Pot</button>
            <input id="customBet" type="number" min="1" placeholder="Custom">
            <button onclick="betCustom()">Go</button>
        </div>
        <button id="pastHandsBtn" onclick="togglePastHands()">Past Hands</button>
        <div id="pastHandsMenu"></div>
    </div>

    <script>
        const svg = document.getElementById('pokerSvg');
        const sitDownBtn = document.getElementById('sitDownBtn');
        const betBtn = document.getElementById('betBtn');
        const betOptions = document.getElementById('betOptions');
        const pastHandsMenu = document.getElementById('pastHandsMenu');

        // Game state
        let players = [];
        let communityCards = [];
        let gameStage = 'waiting';
        let pot = 0;
        let currentPlayerIndex = 0;
        let dealerIndex = 0;
        let hasBetThisRound = new Set();
        let pastHands = [];
        let currentHandBets = { preflop: [], flop: [], turn: [], river: [] };

        // Deck
        const suits = ['♠', '♣', '♥', '♦'];
        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        let deck = [];

        function shuffleDeck() {
            deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push(rank + suit);
                }
            }
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            console.log('Shuffled deck:', deck);
        }

        function drawScene() {
            svg.innerHTML = '';

            // Filters
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const dimFilter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            dimFilter.setAttribute('id', 'dim');
            dimFilter.innerHTML = '<feColorMatrix type="matrix" values="0.5 0 0 0 0  0 0.5 0 0 0  0 0 0.5 0 0  0 0 0 0.5 0"/>';
            defs.appendChild(dimFilter);

            const glowFilter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            glowFilter.setAttribute('id', 'glow');
            glowFilter.innerHTML = `
                <feGaussianBlur stdDeviation="2.5" result="blur"/>
                <feMerge>
                    <feMergeNode in="blur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            `;
            defs.appendChild(glowFilter);
            svg.appendChild(defs);

            // Table
            const table = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
            table.setAttribute('cx', '400');
            table.setAttribute('cy', '300');
            table.setAttribute('rx', '300');
            table.setAttribute('ry', '200');
            table.setAttribute('fill', 'url(#tableGradient)');
            if (gameStage === 'showdown') table.setAttribute('filter', 'url(#dim)');
            svg.appendChild(table);

            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
            gradient.setAttribute('id', 'tableGradient');
            gradient.innerHTML = `
                <stop offset="0%" style="stop-color: #2e7d32;" />
                <stop offset="100%" style="stop-color: #1b5e20;" />
            `;
            defs.appendChild(gradient);

            // Community cards
            const cardWidth = 60;
            const cardSpacing = 10;
            const totalWidth = communityCards.length * cardWidth + (communityCards.length - 1) * cardSpacing;
            const startX = 400 - totalWidth / 2;
            communityCards.forEach((card, i) => {
                drawCard(card, startX + i * (cardWidth + cardSpacing), 270, gameStage === 'showdown');
            });

            // Players
            players.forEach((player, i) => {
                const angle = (i / 6) * 2 * Math.PI;
                const x = 400 + 250 * Math.cos(angle);
                const y = 300 + 150 * Math.sin(angle);

                // Dealer chip
                if (i === dealerIndex) {
                    const dealer = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    dealer.setAttribute('cx', x);
                    dealer.setAttribute('cy', y - 40);
                    dealer.setAttribute('r', '10');
                    dealer.setAttribute('fill', '#000');
                    svg.appendChild(dealer);
                    const dealerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    dealerText.setAttribute('x', x);
                    dealerText.setAttribute('y', y - 36);
                    dealerText.setAttribute('text-anchor', 'middle');
                    dealerText.setAttribute('fill', '#fff');
                    dealerText.setAttribute('font-size', '12');
                    dealerText.textContent = 'D';
                    svg.appendChild(dealerText);
                }

                // Player name and chips
                const nameText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                nameText.setAttribute('x', x);
                nameText.setAttribute('y', y + 120);
                nameText.setAttribute('text-anchor', 'middle');
                nameText.setAttribute('fill', '#000');
                nameText.setAttribute('font-size', '16');
                nameText.textContent = player.name;
                svg.appendChild(nameText);

                const chipBox = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                chipBox.setAttribute('x', x - 40);
                chipBox.setAttribute('y', y + 130);
                chipBox.setAttribute('width', '80');
                chipBox.setAttribute('height', '25');
                chipBox.setAttribute('fill', '#fff');
                chipBox.setAttribute('stroke', '#333');
                chipBox.setAttribute('stroke-width', '1');
                chipBox.setAttribute('rx', '5');
                svg.appendChild(chipBox);

                const chipText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                chipText.setAttribute('x', x);
                chipText.setAttribute('y', y + 148);
                chipText.setAttribute('text-anchor', 'middle');
                chipText.setAttribute('fill', '#000');
                chipText.setAttribute('font-size', '14');
                chipText.textContent = player.chips;
                svg.appendChild(chipText);

                if (player.cards && (i === currentPlayerIndex || gameStage === 'showdown')) {
                    const isWinner = gameStage === 'showdown' && i === currentPlayerIndex;
                    drawCard(player.cards[0], x - 45, y - 25, !isWinner, isWinner);
                    drawCard(player.cards[1], x + 15, y - 25, !isWinner, isWinner);
                }
            });

            // Pot
            const potText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            potText.setAttribute('x', '400');
            potText.setAttribute('y', '400');
            potText.setAttribute('text-anchor', 'middle');
            potText.setAttribute('fill', '#fff');
            potText.setAttribute('font-size', '20');
            potText.textContent = `Pot: ${pot}`;
            svg.appendChild(potText);
        }

        function drawCard(card, x, y, dim = false, highlight = false) {
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x);
            rect.setAttribute('y', y);
            rect.setAttribute('width', '60');
            rect.setAttribute('height', '80');
            rect.setAttribute('fill', '#fff');
            rect.setAttribute('stroke', '#333');
            rect.setAttribute('stroke-width', '2');
            rect.setAttribute('rx', '5');
            if (dim) rect.setAttribute('filter', 'url(#dim)');
            if (highlight) {
                rect.setAttribute('filter', 'url(#glow)');
                rect.setAttribute('stroke', '#ffd700');
                rect.setAttribute('stroke-width', '3');
            }
            svg.appendChild(rect);

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x + 30);
            text.setAttribute('y', y + 45);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', card.includes('♥') || card.includes('♦') ? '#d32f2f' : '#000');
            text.setAttribute('font-size', '20');
            text.textContent = card;
            if (dim) text.setAttribute('filter', 'url(#dim)');
            svg.appendChild(text);
        }

        function sitDown() {
            if (players.length < 6 && !players.some(p => p.isYou)) {
                const name = prompt("Enter your name:", "Player");
                if (!name) return;
                const chips = parseInt(prompt("Enter your starting chips (min 10):", "100")) || 100;
                const player = { 
                    id: players.length + 1, 
                    chips: Math.max(10, chips), 
                    cards: [], 
                    isYou: true, 
                    name: name || `Player${players.length + 1}`
                };
                players.push(player);
                currentPlayerIndex = players.length - 1;
                sitDownBtn.style.display = 'none';
                betBtn.disabled = false;
                if (players.length === 1) {
                    startGame();
                } else {
                    drawScene();
                }
            }
        }

        function startGame() {
            shuffleDeck();
            gameStage = 'preflop';
            players.forEach(player => {
                player.cards = [deck.pop(), deck.pop()];
            });
            hasBetThisRound.clear();
            currentHandBets = { preflop: [], flop: [], turn: [], river: [] };
            drawScene();
        }

        function toggleBetOptions() {
            if (betBtn.disabled) return;
            betOptions.style.display = betOptions.style.display === 'flex' ? 'none' : 'flex';
        }

        function bet(amount) {
            if (gameStage === 'waiting' || gameStage === 'showdown') return;
            const player = players[currentPlayerIndex];
            if (hasBetThisRound.has(player.id) || player.chips < amount) return;
            player.chips -= amount;
            pot += amount;
            hasBetThisRound.add(player.id);
            currentHandBets[gameStage].push({ player: player.name, amount });
            betOptions.style.display = 'none';
            betBtn.disabled = true;
            drawScene();
        }

        function betCustom() {
            const amount = parseInt(document.getElementById('customBet').value);
            if (!isNaN(amount) && amount > 0) bet(amount);
        }

        function fold() {
            if (gameStage === 'waiting' || gameStage === 'showdown') return;
            players.splice(currentPlayerIndex, 1);
            if (players.length === 0) {
                gameStage = 'waiting';
                pot = 0;
                betBtn.disabled = true;
            } else {
                currentPlayerIndex = currentPlayerIndex % players.length;
            }
            drawScene();
        }

        function advanceGame() {
            if (gameStage === 'waiting') return;
            if (gameStage === 'preflop') {
                communityCards = [deck.pop(), deck.pop(), deck.pop()];
                gameStage = 'flop';
            } else if (gameStage === 'flop') {
                communityCards.push(deck.pop());
                gameStage = 'turn';
            } else if (gameStage === 'turn') {
                communityCards.push(deck.pop());
                gameStage = 'river';
            } else if (gameStage === 'river') {
                gameStage = 'showdown';
                awardPot();
            } else if (gameStage === 'showdown') {
                resetGame();
            }
            hasBetThisRound.clear();
            betBtn.disabled = false;
            drawScene();
        }

        function awardPot() {
            const winner = players[currentPlayerIndex]; // Simulated winner
            winner.chips += pot;
            pastHands.push({
                players: players.map(p => ({ name: p.name, cards: [...p.cards], chips: p.chips })),
                communityCards: [...communityCards],
                bets: { ...currentHandBets },
                pot,
                winner: winner.name
            });
            pot = 0;
            updatePastHandsMenu();
        }

        function resetGame() {
            players.forEach(p => p.cards = []);
            communityCards = [];
            pot = 0;
            gameStage = 'preflop';
            hasBetThisRound.clear();
            startGame();
        }

        function togglePastHands() {
            pastHandsMenu.style.display = pastHandsMenu.style.display === 'block' ? 'none' : 'block';
        }

        function updatePastHandsMenu() {
            pastHandsMenu.innerHTML = '<h3>Past Hands</h3>';
            pastHands.forEach((hand, index) => {
                const entry = document.createElement('div');
                entry.className = 'hand-entry';
                entry.innerHTML = `
                    <strong>Hand ${index + 1} (Winner: ${hand.winner}, Pot: ${hand.pot})</strong><br>
                    Community: ${hand.communityCards.join(', ')}<br>
                    Preflop: ${hand.bets.preflop.map(b => `${b.player}: ${b.amount}`).join(', ') || 'None'}<br>
                    Flop: ${hand.bets.flop.map(b => `${b.player}: ${b.amount}`).join(', ') || 'None'}<br>
                    Turn: ${hand.bets.turn.map(b => `${b.player}: ${b.amount}`).join(', ') || 'None'}<br>
                    River: ${hand.bets.river.map(b => `${b.player}: ${b.amount}`).join(', ') || 'None'}<br>
                    Players: ${hand.players.map(p => `${p.name} (${p.cards.join(', ')}, ${p.chips} chips)`).join('; ')}
                `;
                pastHandsMenu.appendChild(entry);
            });
        }

        // Initial draw
        drawScene();
    </script>
</body>
</html>
